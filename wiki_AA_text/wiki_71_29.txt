Windows bitmap
BMP（ビーエムピー、Microsoft Windows Bitmap Image）またはDIB（ディーアイビー、Device Independent Bitmap、デバイス独立ビットマップ）は、マイクロソフトとIBMがWindowsとOS/2にわかれる前のOSを共同で開発していた頃に作られた画像ファイル形式。圧縮の方法についても定義されているが、Windowsが標準では無圧縮のファイルを生成するため、他のアプリケーションにおいても無指定時は、圧縮はされていない場合が多い。
ファイル形式の細部の変更が何度か行われており、その結果としてWindowsとOS/2で多少ファイル形式が異なることがある。
機械独立のファイル形式として設計されたため、実際に存在する画像表示装置や、印刷装置が、画像を上方から処理するものがほぼ全てであるにもかかわらず、幾何学的なX軸、Y軸方向に座標を指定する形式となっている。その結果、画像を下から上に向かって記録している (Bottom up) のが特徴であるが、後に高さに負の値を指定することでその他大多数の画像ファイル形式と同じように画像を上から下へ向かって記録する (Top down) こともできるようになった。しかし互換性の面からProgramming Windowsではトップダウン形式のビットマップの作成を推奨していない。
なお、ビットマップという呼称は画像データの表現方式のひとつであり、本項で述べている"マイクロソフト独自のファイル形式"を必ずしも指すわけではない。
ビットマップファイルは、以下のブロックに分かれている。
14バイトからなる、ビットマップファイルのファイルヘッダである。
参考URL
http://msdn.microsoft.com/en-us/library/dd183374(VS.85).aspx
OS/2 2.xで使用されたファイルヘッダ。BITMAPFILEHEADERを拡張したものだがサイズは同じ。
このブロックは、アプリケーションが画像を描画するための画像の詳細な情報が書かれており、14バイト目から始まる。
OS/2のビットマップで使われる情報ヘッダで、12バイトある。coreヘッダと呼ばれる。
参考URL
http://msdn.microsoft.com/en-us/library/dd183372(VS.85).aspx
http://www.programmers@heaven.com/mb/graphics/148346/152845/re-planes/?S=B20000
（スパムフィルターに引っかかるためアドレスに@を入れています。@を除くこと）
Windowsのビットマップで使われる情報ヘッダで、40バイトある。多くのビットマップがこの形式で保存されている。infoヘッダと呼ばれる。
参考URL
http://msdn.microsoft.com/en-us/library/dd183376(VS.85).aspx
OS/2 V2以降対応した情報ヘッダである。サイズは可変であり、最大64バイト。
Windows 95、Windows NT 4.0から対応した情報ヘッダ。V4ヘッダと呼ばれる。
参考URL
http://msdn.microsoft.com/en-us/library/dd183380(VS.85).aspx
Windows 98、Windows 2000から対応した情報ヘッダ。V5ヘッダと呼ばれる。
参考URL
http://msdn.microsoft.com/en-us/library/dd183381(VS.85).aspx
過去に、EGAやVGAディスプレイカードで使われていた概念で、現在は全く使われない。
この概念が使われていた頃は、実際の色深度を「1ピクセルあたりのビット数×プレーン数」で算出する必要があった。
※1 数字と定義されている圧縮形式の関係は以下の通り
上記以外の圧縮形式は以下の通り
V4ヘッダで、'Win 'と'sRGB'が使用できるというドキュメントが存在する。
カラーマスクはビットフィールド形式が使用されているビットマップから各色成分を取り出す際に使用されるデータである。
カラーマスクブロックは、情報ヘッダがINFOヘッダかつビットフィールド形式が使用されている場合のみ存在する。
V4、V5ヘッダの場合は、ヘッダ内に値が格納されるためこのブロックは存在しない。カラーマスクは赤成分、緑成分、青成分の順で書かれており、それぞれ4バイト、合計12バイトである。α成分のカラーマスクは存在しない。
1ピクセルあたりのビット数とカラーマスクの組み合わせが以下である場合は、圧縮形式を非圧縮に設定し、カラーマスクブロックを省略できる。
このブロックは、画像内で使用される色を定義している。上述の通り、ビットマップ画像はピクセルごとに保存されている。各ピクセルは、1バイト以上を使用して値を保持している。したがって、各値と実際の色の関係を、アプリケーションに教えることがカラーパレットの目的である。
典型的なビットマップファイルはRGBカラーモデルを使用している。このモデルにおいて、色は赤 (R)、緑 (G)、青 (B) のそれぞれの強さ (0-255) で表される。
1色3バイトで表記する形式
1色4バイトで表記する形式、OS/2ビットマップにおけるRGB2もこちらに相当する。
このブロックは、イメージを各ピクセルごとに記述する。ピクセルは通常、左下から右下へ、これを下から上に向かって保存する。各ピクセルは1バイト以上で記述されている。直接RGBデータが置かれる場合のデータ順は、上項カラーパレットに準ずる。水平方向のバイト数が4の倍数ではないときは、0x00で埋めて4の倍数にする。
プログラムでBMP画像を平易に扱うためのライブラリも数多く存在している。
サードパーティ製のライブラリに関しての各詳細は、外部リンクの項に記載している。
